<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sdesaireader - Gujarati Only</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      color: #333;
    }
    .container { 
      max-width: 500px; 
      margin: 0 auto; 
      background: white; 
      border-radius: 20px; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    .header { 
      background: #2c3e50; 
      color: white; 
      padding: 20px; 
      text-align: center; 
    }
    .upload-area { 
      border: 3px dashed #3498db; 
      padding: 40px 20px; 
      margin: 20px; 
      border-radius: 15px; 
      cursor: pointer; 
      background: #f8f9fa;
      transition: all 0.3s;
      text-align: center;
    }
    .upload-area:hover { background: #e3f2fd; }
    button { 
      width: 100%; 
      padding: 15px; 
      margin: 10px 20px; 
      border: none; 
      border-radius: 10px; 
      font-size: 16px; 
      font-weight: bold; 
      cursor: pointer; 
      transition: all 0.3s;
    }
    .extract-btn { background: #3498db; color: white; }
    .extract-btn:disabled { background: #bdc3c7; }
    .read-btn { background: #27ae60; color: white; }
    .read-btn:disabled { background: #bdc3c7; }
    .stop-btn { background: #e74c3c; color: white; }
    #output { 
      min-height: 150px; 
      padding: 20px; 
      margin: 0 20px 20px 20px; 
      background: #f8f9fa; 
      border-radius: 10px; 
      border: 1px solid #dee2e6;
      white-space: pre-wrap;
      font-size: 16px;
      line-height: 1.6;
      text-align: left;
    }
    .status { 
      padding: 15px; 
      text-align: center; 
      font-weight: bold; 
      font-size: 16px;
      background: #d4edda;
      color: #155724;
      border-bottom: 1px solid #c3e6cb;
    }
    .error { 
      background: #f8d7da !important; 
      color: #721c24 !important; 
      border-bottom-color: #f5c6cb !important;
    }
    .voice-info { 
      background: #d1ecf1; 
      color: #0c5460; 
      padding: 10px; 
      font-size: 14px; 
      text-align: center;
      display: none;
    }
    .voice-missing { 
      background: #fff3cd !important; 
      color: #856404 !important; 
      display: block !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üìñ Sdesaireader</h1>
      <p>Read Gujarati text aloud</p>
    </div>

    <div class="voice-info" id="voiceInfo">
      ‚úÖ Gujarati voice ready! Ready to read.
    </div>

    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
      <p id="uploadText">üìÅ Tap to upload image or PDF</p>
      <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png" style="display:none;" />
    </div>

    <div class="status" id="status">Ready to start</div>

    <button class="extract-btn" id="extractBtn" disabled>üîç Extract Text</button>
    <button class="read-btn" id="readBtn" disabled>üó£Ô∏è Read in Gujarati</button>
    <button class="stop-btn" id="stopBtn">‚èπÔ∏è Stop</button>

    <div id="output">Your extracted text will appear here...</div>
  </div>

  <script src="https://unpkg.com/tesseract.js@v2.1.5/dist/tesseract.min.js"></script>

  <script>
    const fileInput = document.getElementById('fileInput');
    const extractBtn = document.getElementById('extractBtn');
    const readBtn = document.getElementById('readBtn');
    const stopBtn = document.getElementById('stopBtn');
    const status = document.getElementById('status');
    const output = document.getElementById('output');
    const voiceInfo = document.getElementById('voiceInfo');

    let extractedText = "";
    let hasGujaratiVoice = false;

    // Check for Gujarati voice
    function checkGujaratiVoice() {
      const voices = window.speechSynthesis.getVoices();
      hasGujaratiVoice = voices.some(voice => 
        voice.lang.toLowerCase().includes('gu') || 
        voice.name.toLowerCase().includes('gujarati')
      );
      
      if (hasGujaratiVoice) {
        voiceInfo.className = "voice-info";
        voiceInfo.innerHTML = "‚úÖ <strong>Gujarati voice found!</strong> Ready to read.";
      } else {
        voiceInfo.className = "voice-info voice-missing";
        voiceInfo.innerHTML = `
          ‚ö†Ô∏è <strong>Gujarati voice missing!</strong><br>
          <small>
            <strong>iPhone:</strong> Settings ‚Üí Accessibility ‚Üí Spoken Content ‚Üí Voices ‚Üí Gujarati ‚Üí Download<br>
            <strong>Android:</strong> Settings ‚Üí Google ‚Üí Voice ‚Üí Text-to-speech ‚Üí Install voice data (Gujarati)
          </small>
        `;
      }
    }

    // Load voices when available
    if (window.speechSynthesis.getVoices().length > 0) {
      checkGujaratiVoice();
    } else {
      window.speechSynthesis.onvoiceschanged = checkGujaratiVoice;
      // Force load
      setTimeout(() => window.speechSynthesis.getVoices(), 100);
    }

    // File upload
    fileInput.onchange = function() {
      if (this.files.length > 0) {
        status.textContent = "File selected! Click Extract.";
        extractBtn.disabled = false;
        document.getElementById('uploadText').textContent = this.files[0].name;
      }
    };

    // Extract text
    extractBtn.onclick = async function() {
      status.textContent = "Extracting text...";
      extractBtn.disabled = true;
      
      try {
        const worker = await Tesseract.createWorker('eng+hin+guj');
        await worker.loadLanguage('eng+hin+guj');
        await worker.initialize('eng+hin+guj');
        const { data: { text } } = await worker.recognize(fileInput.files[0]);
        await worker.terminate();

        // Clean Gujarati text: keep only Gujarati characters, spaces, and basic punctuation
        extractedText = text
          .replace(/[^\u0A80-\u0AFF\u0020\u002C\u002E\u003F\u003A]/g, '') // Keep Gujarati + space, comma, dot, ?, :
          .replace(/\s+/g, ' ')
          .trim();

        output.textContent = extractedText || "No Gujarati text found.";
        
        if (extractedText.length > 5) {
          status.textContent = `Gujarati text extracted! (${extractedText.length} chars)`;
          readBtn.disabled = false;
        } else {
          status.className = "status error";
          status.textContent = "No clear Gujarati text found. Try a clearer image.";
          readBtn.disabled = true;
        }
      } catch (error) {
        status.className = "status error";
        status.textContent = "Error extracting text. Try again.";
        console.error(error);
      }
      
      extractBtn.disabled = false;
    };

    // Read in Gujarati only
    readBtn.onclick = function() {
      if (!hasGujaratiVoice) {
        status.className = "status error";
        status.textContent = "Gujarati voice required! Please install it first.";
        return;
      }

      if (!extractedText || extractedText.length < 5) {
        status.className = "status error";
        status.textContent = "No Gujarati text to read.";
        return;
      }

      window.speechSynthesis.cancel();

      const utterance = new SpeechSynthesisUtterance(extractedText);
      
      // Force Gujarati voice only
      const gujVoice = window.speechSynthesis.getVoices().find(voice => 
        voice.lang.toLowerCase().includes('gu') || 
        voice.name.toLowerCase().includes('gujarati')
      );

      if (gujVoice) {
        utterance.voice = gujVoice;
        utterance.lang = 'gu-IN';
      }

      utterance.rate = 0.85; // Slightly slower for clarity
      utterance.pitch = 1.0;
      utterance.volume = 1.0;

      utterance.onstart = function() {
        status.textContent = "Reading in Gujarati... üé§";
        readBtn.disabled = true;
      };

      utterance.onend = function() {
        status.textContent = "Finished reading! ‚úÖ";
        readBtn.disabled = false;
      };

      utterance.onerror = function(event) {
        status.className = "status error";
        status.textContent = `Error: ${event.error}. Check voice settings.`;
        readBtn.disabled = false;
      };

      window.speechSynthesis.speak(utterance);
    };

    // Stop
    stopBtn.onclick = function() {
      window.speechSynthesis.cancel();
      status.textContent = "Stopped. Ready to read again.";
      readBtn.disabled = false;
    };
  </script>
</body>
</html>
